```{r executive, echo = FALSE}
executive <- list()
executive[["stock"]] <- paste0("This assessment reports the status of ",
  spp, " (_", spp.sci, "_) off the ", coast, 
  " coast using data through 2020.")
```
# Executive Summary{-}

## Stock{-}
`r executive[["stock"]]` `r spp` are also harvested from the waters off British Columbia and in the Gulf of Alaska, and although those catches were not included in this assessment, it is not certain if those populations contribute to the biomass of `r spp` off of the U.S. West Coast.

## Landings{-}
`r spp` were first landed in California in the early part of the 20th century and the fishery began increasing landings in Oregon and Washington in the 1940's.  Landings remained relatively constant throughout the 1950's and 1960's before increasing rapidly into the early 1990's.  Subsequently, the landings declined (mostly in California) until 2007 when harvest guidelines increased the allowable catch.  Groundfish trawl fisheries land the majority of `r spp` while fixed gears, shrimp trawls, and recreational fisheries make up a very small amount of fishing mortality.  Some discarding of `r spp` occured in the fisheries, primarily prior to the implementation of the Catch Shares Program in 2011.  Discards were estimated in the model and total catches are reported, as opposed to landings.

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "catch2 landings stacked.png"), 
caption = "Landings by fleet used in the base model",
label = 'es-catch',
width = 75, 
height = 100)
```	

\input{tex_tables/a_Catches_ES.tex}

## Data and Assessment{-}

`r spp` off the west coast of the U.S. was assessed here using the length- and age-structured model Stock Synthesis (version 3.30.16).  The last assessment was done in 2011 and showed the stock to be increasing with a 2011 depletion level at 84 percent of virgin spawning biomass. In this assessment, aspects of the model including fleet structure, landings, data, and modelling assumptions were re-evaluated. The coastwide population was modeled allowing separate growth and mortality parameters for each sex (i.e., a two-sex model) from `r startyr` to `r endyr` and forecasted beyond `r endyr`.

All of the data sources included in the base model for `r spp` have been re-evaluated for this assessment. Changes in varying degress have occurred in the data from those used in the previous assessment. The historical landings has been updated for California and Oregon relative to those used in 2011. Survey data from the Alaska and Northwest Fisheries Science Centers have been used to construct indices of abundance analyzed using a spatio-temporal delta-model (e.g., VAST). 

The definition of fishing fleets have changed from those in the 2011 assessment. The new assessment assumed two fishing fleets in the model: 1) a combined gear California fleet and 2) a combined gear Oregon/Washington fleet. The update in fleet grouping for Oregon and Washington was suggested by state representative during the pre-assessment data meeting. Separating data between Oregon and Washington can be challenging due to fishing and landing across state boundaries. 

This assessment uses landings data and discard estimates; survey indices of abundance, length- or age-composition data for each fishery or survey (with conditional age-at-length data used for the \gls{s-nwslope} and \gls{s-wcgbt}); information on weight-at-length, maurity-at-length, and fecundity-at-length; information on natural mortality and the steepness of the Beverton-Holt stock-recruitment relationship; and estiamtes of ageing error. Estimates of recruitment at equilibrium spawning output ($R_0$), annual recruitment deviations, sex-specific length-based selectivity of the fisheries and surveys, retention for each of the fishery fleets, catchability of the surveys, sex-specific growth, the time series of spawning output, age and size structure, and current and project future stock status are outputs of the model. 

A number of sources of uncertainty are explicitly included in this assessment. A base model was selected that best captures the central tendency for those sources of uncertainty considered in the model.

## Stock Biomass{-}

The estimated spawning biomass across all years had the most significant decline occuring in the late 1990s following high catch levels in the 1980s and early 1990s. 


\input{tex_tables/b_SSB_ES.tex}

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots",
"ts7_Spawning_biomass_(mt)_with_95_asymptotic_intervals_intervals.png"), 
caption = "Estimated time series of spawning output (circles and line: median; light broken lines: 95 percent intervals) for the base model",
label = 'es-ssb',
width = 100,
height = 75)
```

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "ts9_Relative_spawning_biomass_intervals.png"), 
caption = "Estimated time series of fraction of unfished spawning output (circles and line: median; light broken lines: 95 percent intervals) for the base model",
label = 'es-depl',
width = 100,
height = 75)
```

## Recruitment{-}
Replace text.

\input{tex_tables/c_Recr_ES.tex}

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "ts11_Age-0_recruits_(1000s)_with_95_asymptotic_intervals.png"), 
caption = "Estimated time series of age-0 recruits (1000s) for the base model with 95 percent intervals",
label = 'es-recruits',
width = 100,
height = 75)
```

## Exploitation Status{-}
Replace text.

\input{tex_tables/d_SPR_ES.tex}

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "SPR2_minusSPRseries.png"), 
caption = "Estimated 1 - relative spawning ratio (SPR) by year for the base model. The management target is plotted as a red horizontal line and values above this reflect harvest in excess of the proxy harvest rate",
label = 'es-1-spr',
width = 100,
height = 75)
```

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "SPR4_phase.png"), 
caption = "Phase plot of estimated 1-SPR versus fraction unfished for the base model",
label = 'es-phase',
width = 100,
height = 75)
```


--------------AARON STOP EDITING HERE----------------------



## Ecosystem Considerations{-}

```{r, echo=FALSE, results='asis'}
filein = file.path(getwd(), "shared_text",'ecosystem_considerations.Rmd')
read_child(filein)
```

## Reference Points{-}

The 2021 spawning output relative to unfished equilibrium spawning output is well above the management target of 25 percent of unfished spawning output. The fishing intensity has been below the current management harvest rate limit ($SPR_{30\%}$) across all modeled years (Figure \ref{fig:es-1-spr}).  The relative biomass compared to the ratio of the estimated SPR to the management target ($SPR_{30\%}$) across all model years are shown in Figure \ref{fig:es-phase} where warmer colors (red) represent early years and colder colors (blue) represent recent years.  The relative biomass and estimated SPR has been well above the management biomass target (25 percent) and well below the SPR target across all model years. Figure \ref{fig:es-yield} shows the equilibrium curve based on a steepness value fixed at `r round(model$parameters[model$parameters$Label == "SR_BH_steep","Value"], 2)` with vertical dashed lines to indicate the estimate of fraction unfish at the start of `r endyr +1` (current) and the estimated management targets calculated based on the relative target biomass (B target), the SPR target, and the maximum sustainable yield (MSY).

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "yield2_yield_curve_with_refpoints.png"), 
caption = "Equilibrium yield curve for the base case model. Values are based on the 2020
fishery selectivities and with steepness fixed at 0.80",
label = 'es-yield',
width = 100,
height = 75)
```

Reference points were calculated using the estimated selectivities and catch distributions among fleets in the most recent year of the model, `r endyr`. Sustainable total yield, landings plus discards, using an $SPR_{30\%}$ is `r round(model$derived_quants[model$derived_quants$Label == 'Dead_Catch_SPR', 'Value'], 2)` mt. The spawning output equivalent to 25 percent of the unfished spawning output ($SB_{25\%}$) calculated using the SPR target ($SPR_{30\%}$) was `r round(model$derived_quants[model$derived_quants$Label == 'SSB_SPR', 'Value'], 0)` millions of eggs. Recent removals have been below the point estimate of the potential long-term yields calculated using an $SPR_{30\%}$ reference point and the population scale has been relatively stable in recent years.

\input{tex_tables/e_ReferencePoints_ES.tex}

## Management Performance{-}

Exploitation on `r spp` slowly increased starting around 1940 and reached a high the early 1990s. After peaking exploitation rates declined steadily through 2006, increased in 2007, but have steadily declined since. In the last ten years the annual catch limit (ACL) has been set well below the overfishing limit (OFL) and acceptable biological catch (ABC).  Total mortality has ranged between 10 - 15 percent of the ACL in the most recent five years.

```{r, results = 'asis'}
yrs = hist = 2011:endyr
nfleets = 2
catch = dead = est.dead = input.catch =  0
for (i in 1:nfleets){
  name = paste0("retain(B):_",i)
  input.catch = model$timeseries[model$timeseries$Yr %in% yrs, name]
  catch = cbind(catch, input.catch)

  name = paste0("dead(B):_",i)
  est.dead = model$timeseries[model$timeseries$Yr %in% yrs, name]
  dead = cbind(dead, est.dead)
}
total.catch <- round(apply(catch, 1, sum),0)
total.dead  <- round(apply(dead, 1, sum), 0)

man = read.csv("//nwcfile/FRAM/Assessments/CurrentAssessments/Dover_sole_2021/management/dover_man_for_doc.csv")
man = man[man$Year %in% yrs, ]
out = cbind(man,  total.catch, total.dead)

col_names = c("Year", "OFL", "ABC", "ACL", "Landings", "Est. Total mortality")

table_format(x = out,
             caption = "The OFL, ABC, ACL, landings, and the estimated total mortality in metric tons.",
             label = "ofl-es",
             align = 'l',
             col_names = col_names)
```

## Unresolved Problems and Major Uncertainties{-}

```{r, echo=FALSE, results='asis'}
filein = file.path(getwd(), "shared_text",'unresolved_problems_uncertainties.Rmd')
read_child(filein)
```


## Scientific Uncertainty{-}

```{r, echo=FALSE, results='asis'}
filein = file.path(getwd(), "shared_text",'scientific_uncertainty.Rmd')
read_child(filein)
```

## Harvest Projections and Decision Table{-}

The forecast of stock abundance and yield was developed using the base model. The total catches in 2021 and 2021 were set at 10,000 mt for each year, since recent year removals are well below the ACLs. These values will be updated based on input provided by the Groundfish Management Team (GMT) of the PFMC. The management adopted ACL values for these years is 50,000 mt. The exploitation rate for 2021 and beyond is based upon an SPR of 30 percent and the 25:5 harvest control rule. The average exploitation rates, across recent years, by fleet were used to distribute catches during the forecast period. 

The ABC values were estimated using a category 1 $\sigma_y$ starting at 0.50 and increasing annually combined with a P* value of 0.45. The catches during the projection period were set equal to the year-specific ABC using the current flatfish harvest control rule, 25:5 (Table \ref{tab:project}). 

The axes of uncertainty and catch streams applied in the decision table will determined during the  STAR panel. 

```{r, results = 'asis'}
tab = read.csv(file.path(mod_loc, 'tables', 'g_Projections_ES.csv'))
spex_removal = c(model$derived_quants[model$derived_quants$Label == "ForeCatch_2021", "Value"], 
                 model$derived_quants[model$derived_quants$Label == "ForeCatch_2022", "Value"])

out = cbind(tab$Year,
            c(93547, 87540, rep("-",10)),
            c(84192, 78436, rep("-",10)),
            c(50000, 50000, rep("-", 10)),
            c(round(spex_removal,0), rep("-", 10)),
            c(rep("-",2), round(tab[3:12,2], 0)),
            c(rep("-",2), round(tab[3:12,3], 0)),
            c(rep("-",2), round(tab[3:12,3]/tab[3:12,2], 3)),
            round(tab[ ,5:ncol(tab)], 2))

col_names = c('Year',
              'Adopted OFL (mt)',
              'Adopted ABC (mt)',
              "Adopted ACL (mt)",
              "Assumed Removal (mt)", 
              "OFL (mt)", 
              "ABC (mt)", 
              "Buffer",
              "Spawning Output",
              "Fraction Unfished")

table_format(x = out,
             caption = "Projections of potential OFLs (mt), ABCs (mt), estimated spawning output, and fraction unfished. The adopted OFL, ABC, and ACL for 2021 and 2022 reflect adopted management limits and the assumed removal is the amount assumed in the projection for 2021 and 2022. The full ABC was assumed to be removed for 2023 - 2032",
             label = "es-project",
             align = 'l',
             landscape = TRUE,
             custom_width = TRUE,
             col_to_adjust = 1:10, 
             width = rep("2cm", 10),
             col_names = col_names)
```

## Research and Data Needs{-}

```{r, echo=FALSE, results='asis'}
filein = file.path(getwd(), "shared_text",'research_and_data_needs.Rmd')
read_child(filein)
```

