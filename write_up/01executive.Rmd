```{r executive, echo = FALSE}
executive <- list()
executive[["stock"]] <- paste0("This assessment reports the status of ",
  spp, " (_", spp.sci, "_) off the ", coast, 
  " coast using data through 2020.")
```
# Executive Summary{-}

## Stock{-}
This assessment reports the status of `r spp` (_`r spp.sci`_) off the U.S. west coast using data through `r endyr`. `r spp` are also harvested from the waters off British Columbia and in the Gulf of Alaska, and although those catches were not included in this assessment, it is not certain if those populations contribute to the biomass of `r spp` off of the U.S. west coast. In general, `r spp` exhibit seasonal ontogenetic movement behavior from shallower feeding grounds on the continental shelf to deeper spawning habitat on the outer continental shelf and slope as they age. However, the specific mechanisms that drive stock structure, and related variability over space and time, are not well understood.

## Landings{-}
`r spp` were first landed in California in the early part of the 20th century and the fishery began increasing landings in Oregon and Washington in the 1940's. Landings remained relatively constant throughout the 1950's and 1960's before increasing rapidly into the early 1990's.  Subsequently, the landings declined by nearly 60 percent in California and in Oregon/Washington until 2007 when harvest guidelines increased the allowable catch.  Since that time, landings have been steadily decreasing to a level in 2020 that is the lowest on record since the 1940's. Groundfish trawl fisheries land the majority of `r spp` while fixed gears, shrimp trawls, and recreational fisheries collectively make up a very small amount of fishing mortality.  Some discarding of `r spp` has occurred in these fisheries, primarily prior to the implementation of the Individual Fishing Quota (IFQ) Catch Shares Program in 2011.  Discards were estimated in the model and total catches are reported, as opposed to landings.

\input{tex_tables/a_Catches_ES.tex}

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "catch2 landings stacked.png"), 
caption = "Landings by fleet used in the base model where catches in metric tons by fleet are stacked",
label = 'es-catch')
```

## Data and Assessment{-}

This stock assessment for `r spp` off the west coast of the U.S. was developed using the length- and age-structured model Stock Synthesis (version 3.30.16).  The most recent stock assessment was done in 2011 and showed the stock to be increasing with a stock status determination of 84 percent of virgin (or unfished) spawning biomass at the beginning of 2011. During the development of this assessment, model specifications including fleet structure, landings, data, and model structural assumptions were re-evaluated. Similar to the previous assessment, a single coastwide population was modeled that allowed for area-specific fleets and separate growth and mortality parameters for each sex (i.e., a two-sex model).  The model time domain was `r startyr` to `r endyr`, with forecasts going beyond `r endyr`.

All of the data sources included in the base model for `r spp` have been re-evaluated for this assessment, including improvements and updates in the data (and associated analyses) that were used in the previous assessment. Landings prior to the mid-1980s have also been updated since the 2011 assessment using the new historical catch reconstruction time-series for California and Oregon. Survey data from the Alaska and Northwest Fisheries Science Centers have been used to construct 4-sets of relative abundance indices, each spanning a different time period, that were independently developed using a spatio-temporal delta-generalized linear mixed model (i.e., VAST) to take into account the survey spatial domain. 

The definition of fishing fleets changed in this assessment relative to those in the 2011 assessment. Two fleets are now defined in the model: 1) a combined gear California fleet and 2) a combined gear Oregon/Washington fleet. The update in fleet grouping for Oregon and Washington was suggested by State representatives during the pre-assessment data meeting because of  similarities in fishing across this region and avoiding the inherent difficulties associated with separating data between Oregon and Washington due to the intermixing of fishing and landing locations across state boundaries. 

This assessment integrates data and information from multiple sources into one modeling framework.  Specifically, the assessment uses landings data and discard estimates; survey indices of abundance, length- or age-composition data for each fishery or survey (with conditional age-at-length data used for the \gls{s-nwslope} and \gls{s-wcgbt}); information on weight-at-length, maturity-at-length, and fecundity-at-length; information on natural mortality and the steepness of the Beverton-Holt stock-recruitment relationship; and estimates of ageing error. The base model was tuned to account for the weighting of composition data as well as the specification of recruitment variance and recruitment bias adjustments.  Estimates of recruitment at equilibrium spawning output ($R_0$), annual recruitment deviations, sex-specific length-based selectivity of the fisheries and surveys, retention for each of the fishery fleets, catchability of the surveys, sex-specific growth, the time series of spawning output, age and size structure, and current and projected future stock status are derived outputs of the model. 

Multiple sources of uncertainty are explicitly included in this assessment, including parameter uncertainty through the use of prior distributions, observational uncertainty through standard deviations of survey estimates, and model uncertainty through a comprehensive sensitivity analyses to data source and model structural assumptions. A base model was selected that best fit the observed data while concomitantly balancing the desire to capture the central tendency across those sources of uncertainty, ensure model realism and tractability, and promote robustness to potential model misspecification.

## Stock Biomass{-}

The terms "spawning output" and "spawning biomass" are used interchangeably in this document in reference to total female spawning biomass.  For the purposes of this assessment, female spawning biomass is assumed to be proportional to egg and larval production.  The estimated spawning biomass at the beginning of 2021 was 232,065 mt (~95 percent asymptotic intervals: 154,153 to 309,978 mt), which when compared to unfished spawning biomass (294,070 mt) equates to a relative stock status level of 79 percent (~95 percent asymptotic intervals: 71 to 87 percent).  Overall, spawning stock biomass has steadily declined from near unfished levels in the 1940's to a time series low of 60 percent of unfished levels in the 1990's following high landings in the 1980's and early 1990's. Over the past two decades, spawning stock biomass has generally been increasing as total landings have decreased, returning to levels similar to those seen in the 1950's and 1960's. The stock is estimated to be well above the management target of $SB_{25\%}$ in 2021, and has remained well above the target throughout the time series.

\input{tex_tables/b_SSB_ES.tex}

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots",
"ts7_Spawning_biomass_(mt)_with_95_asymptotic_intervals_intervals.png"), 
caption = "Estimated time series of spawning output (circles and line: median; light broken lines: 95 percent intervals) for the base model",
label = 'es-ssb')
```

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "ts9_Relative_spawning_biomass_intervals.png"), 
caption = "Estimated time series of fraction of unfished spawning output (circles and line: median; light broken lines: 95 percent intervals) for the base model",
label = 'es-depl')
```

\clearpage

## Recruitment{-}

There is large uncertainty associated with annual differences in recruitment across much of the time series due to a lack of informative data during the early period and little contrast in composition and index data in the later period to signal much variation in cohort strength. Data were most informative from the early 2000's to the mid 2010's, where estimates showed periods of below average recruitment (2002-2006) and above average recruitment (2008-2010). The 2000 and 2009 year classes are estimated to be the largest across the time series and were well determined as being well above average (i.e., ~95 percent asymptotic intervals did not span 0). Overall, the `r spp` stock has not been reduced to levels that would provide considerable information on how recruitment changes with spawning biomass at low spawning biomass levels (i.e., inform the steepness parameter).  Thus, all recruitment is based on a fixed assumption about steepness (0.80) and recruitment variability ($\sigma_R$ = 0.35).

\input{tex_tables/c_Recr_ES.tex}

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "ts11_Age-0_recruits_(1000s)_with_95_asymptotic_intervals.png"), 
caption = "Estimated time series of age-0 recruits (1000s) for the base model with 95 percent intervals",
label = 'es-recruits')
```

\clearpage

## Exploitation Status{-}

Trends in fishing intensity (1 - SPR) largely mirrored that of landings given the relative lack of large variations in annual recruitment such that there was a steady increase from the 1940's to the mid to late 1980's before decreasing to current levels of 11 percent for 2020.  The maximum fishing intensity was 0.45 in 1991, well below the target harvest rate of 0.70. Exploitation rates over the past decade have ranged between 0.01 and 0.02.  Current estimates indicate that `r spp` spawning biomass is 3.2 times higher than the target biomass level ($SB_{25\%}$), and fishing intensity remains 6.3 times lower than the target harvest rate.

\input{tex_tables/d_SPR_ES.tex}

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "SPR2_minusSPRseries.png"), 
caption = "Estimated 1 - relative spawning ratio (SPR) by year for the base model. The management target is plotted as a red horizontal line and values above this reflect harvest in excess of the proxy harvest rate",
label = 'es-1-spr')
```

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "SPR4_phase.png"), 
caption = "Phase plot of estimated 1-SPR versus fraction unfished for the base model",
label = 'es-phase')
```

\clearpage

## Ecosystem Considerations{-}

```{r, echo=FALSE, results='asis'}
filein = file.path(getwd(), "shared_text",'ecosystem_considerations.Rmd')
read_child(filein)
```

## Reference Points{-}

The 2021 spawning output relative to unfished equilibrium spawning output is well above the management target of 25 percent of unfished spawning output. The fishing intensity has been below the current management harvest rate limit ($SPR_{30\%}$) across all modeled years (Figure \ref{fig:es-1-spr}).  The relative biomass compared to the ratio of the estimated SPR to the management target ($SPR_{30\%}$) across all model years are shown in Figure \ref{fig:es-phase} where warmer colors (red) represent early years and colder colors (blue) represent recent years.  The relative biomass and estimated SPR has been well above the management biomass target (25 percent) and well below the SPR target across all model years. Figure \ref{fig:es-yield} shows the equilibrium curve based on a steepness value fixed at `r round(model$parameters[model$parameters$Label == "SR_BH_steep","Value"], 2)` with vertical dashed lines to indicate the estimate of fraction unfish at the start of `r endyr +1` (current) and the estimated management targets calculated based on the relative target biomass (B target), the SPR target, and the maximum sustainable yield (MSY).

```{r, results = 'asis'}
add_figure(
filein = file.path(mod_loc, "plots", "yield2_yield_curve_with_refpoints.png"), 
caption = "Equilibrium yield curve for the base case model. Values are based on the 2020
fishery selectivities and with steepness fixed at 0.80",
label = 'es-yield')
```

Reference points were calculated using the estimated selectivities and catch distributions among fleets in the most recent year of the model, `r endyr`. Sustainable total yield, landings plus discards, using an $SPR_{30\%}$ is `r format(model$derived_quants[model$derived_quants$Label == 'Dead_Catch_SPR', 'Value'], digits = 0, scientific = FALSE)` mt. The spawning output equivalent to 25 percent of the unfished spawning output ($SB_{25\%}$) calculated using the SPR target ($SPR_{30\%}$) was `r format(model$derived_quants[model$derived_quants$Label == 'SSB_SPR', 'Value'], digits = 0, scientific = FALSE)` mt. Recent removals have been below the point estimate of the potential long-term yields calculated using an $SPR_{30\%}$ reference point and the population scale has been relatively stable in recent years.

\input{tex_tables/e_ReferencePoints_ES.tex}

\clearpage

## Management Performance{-}

Exploitation on `r spp` slowly increased starting around 1940 and reached a high the early 1990s. After peaking exploitation rates declined steadily through 2006, increased in 2007, but have steadily declined since. In the last ten years the annual catch limit (ACL) has been set well below the overfishing limit (OFL) and acceptable biological catch (ABC).  Total mortality has ranged between 10 - 15 percent of the ACL in the most recent five years.

```{r, results = 'asis'}
yrs = hist = 2011:endyr
nfleets = 2
catch = dead = est.dead = input.catch =  0
for (i in 1:nfleets){
  name = paste0("retain(B):_",i)
  input.catch = model$timeseries[model$timeseries$Yr %in% yrs, name]
  catch = cbind(catch, input.catch)

  name = paste0("dead(B):_",i)
  est.dead = model$timeseries[model$timeseries$Yr %in% yrs, name]
  dead = cbind(dead, est.dead)
}
total.catch <- round(apply(catch, 1, sum),0)
total.dead  <- round(apply(dead, 1, sum), 0)

man = read.csv("//nwcfile/FRAM/Assessments/CurrentAssessments/Dover_sole_2021/management/dover_man_for_doc.csv")
man = man[man$Year %in% yrs, ]
out = cbind(man,  total.catch, total.dead)

col_names = c("Year", "OFL", "ABC", "ACL", "Landings", "Est. Total Mortality")

table_format(x = out,
             caption = "The OFL, ABC, ACL, landings, and the estimated total mortality in metric tons.",
             label = "ofl-es",
             align = 'l',
             col_names = col_names)
```

## Unresolved Problems and Major Uncertainties{-}

```{r, echo=FALSE, results='asis'}
filein = file.path(getwd(), "shared_text",'unresolved_problems_uncertainties.Rmd')
read_child(filein)
```

## Scientific Uncertainty{-}

```{r, echo=FALSE, results='asis'}
filein = file.path(getwd(), "shared_text",'scientific_uncertainty.Rmd')
read_child(filein)
```

## Harvest Projections and Decision Table{-}

The forecast of stock abundance and yield was developed using the base model. The total catches in 2021 and 2021 were set at 10,000 mt for each year, since recent year removals are well below the ACLs. These values will be updated based on input provided by the Groundfish Management Team (GMT) of the PFMC. The management adopted ACL values for these years is 50,000 mt. The exploitation rate for 2021 and beyond is based upon an SPR of 30 percent and the 25:5 harvest control rule. The average exploitation rates, across recent years, by fleet were used to distribute catches during the forecast period. 

The ABC values were estimated using a category 1 $\sigma_y$ starting at 0.50 and increasing annually combined with a P* value of 0.45. The catches during the projection period were set equal to the year-specific ABC using the current flatfish harvest control rule, 25:5 (Table \ref{tab:project}). 

The axes of uncertainty and catch streams applied in the decision table will determined during the  STAR panel. 

```{r, results = 'asis'}
tab = read.csv(file.path(mod_loc, 'tables', 'g_Projections_ES.csv'))
spex_removal = c(model$derived_quants[model$derived_quants$Label == "ForeCatch_2021", "Value"], 
                 model$derived_quants[model$derived_quants$Label == "ForeCatch_2022", "Value"])

out = cbind(tab$Year,
            c(93547, 87540, rep("-",10)),
            c(84192, 78436, rep("-",10)),
            c(50000, 50000, rep("-", 10)),
            c(round(spex_removal,0), rep("-", 10)),
            c(rep("-",2), round(tab[3:12,2], 0)),
            c(rep("-",2), round(tab[3:12,3], 0)),
            c(rep("-",2), round(tab[3:12,3]/tab[3:12,2], 3)),
            round(tab[ ,5:ncol(tab)], 2))

col_names = c('Year',
              'Adopted OFL (mt)',
              'Adopted ABC (mt)',
              "Adopted ACL (mt)",
              "Assumed Removal (mt)", 
              "OFL (mt)", 
              "ABC (mt)", 
              "Buffer",
              "Spawning Output",
              "Fraction Unfished")

table_format(x = out,
             caption = "Projections of potential OFLs (mt), ABCs (mt), estimated spawning output, and fraction unfished. The adopted OFL, ABC, and ACL for 2021 and 2022 reflect adopted management limits and the assumed removal is the amount assumed in the projection for 2021 and 2022. The full ABC was assumed to be removed for 2023 - 2032",
             label = "es-project",
             align = 'l',
             landscape = TRUE,
             custom_width = TRUE,
             col_to_adjust = 1:10, 
             width = rep("2cm", 10),
             col_names = col_names)
```

## Research and Data Needs{-}

```{r, echo=FALSE, results='asis'}
filein = file.path(getwd(), "shared_text",'research_and_data_needs.Rmd')
read_child(filein)
```

