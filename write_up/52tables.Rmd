\clearpage
# Tables


<!-- ======================================================= -->
<!-- ***************    Catches      *********************** --> 
<!-- ======================================================= -->
```{r, results = 'asis'}

catch = read.csv("//nwcfile/FRAM/Assessments/CurrentAssessments/Dover_sole_2021/data/catches/forSS/commercial_catch_by_state.csv")

years = startyr:endyr
nfleets = 2
dead = est.dead =  0
for (i in 1:nfleets){
  name = paste0("dead(B):_",i)
  est.dead = model$timeseries[model$timeseries$Yr %in% years, name]
  dead = cbind(dead, est.dead)
}
total.dead  <- round(apply(dead, 1, sum), 0)
tot = round(apply(catch[,2:4], 1, sum),0)
out = cbind(catch, tot, total.dead)

col_names = c("Year", "California", "Oregon", "Washington", "Landings", "Est. Total Mortality")

table_format(x = out,
             caption = "Removals (mt) by state, the summed landings across states (mt), and the estimated total mortality (mt) summed by year. Oregon and Washington were combined into a single fleet in the model",
             label = "allcatches",
             digits = 0,
             align = 'l',
             col_names = col_names)
```

\newpage

\newpage

<!-- ======================================================= --> 
<!-- *********** Removals vs. OFL/ACL   ******************** --> 
<!-- ======================================================= --> 


```{r, results = 'asis'}
yrs = hist = 2011:endyr
nfleets = 2
catch = dead = est.dead = input.catch =  0
for (i in 1:nfleets){
  name = paste0("retain(B):_",i)
  input.catch = model$timeseries[model$timeseries$Yr %in% yrs, name]
  catch = cbind(catch, input.catch)

  name = paste0("dead(B):_",i)
  est.dead = model$timeseries[model$timeseries$Yr %in% yrs, name]
  dead = cbind(dead, est.dead)
}
total.catch <- round(apply(catch, 1, sum),0)
total.dead  <- round(apply(dead, 1, sum), 0)

man = read.csv("//nwcfile/FRAM/Assessments/CurrentAssessments/Dover_sole_2021/management/dover_man_for_doc.csv")
man = man[man$Year %in% yrs, ]
out = cbind(man,  total.catch, total.dead)

col_names = c("Year", "OFL", "ABC", "ACL", "Landings", "Est. Total Mortality")

table_format(x = out,
             caption = "The OFL, ABC, ACL, landings, and the estimated total mortality in metric tons.",
             label = "ofl",
             align = 'l',
             col_names = col_names)
```

\newpage

<!-- ======================================================= -->
<!-- ***************   Discard Data  *********************** --> 
<!-- ======================================================= -->

\include{tex_tables/discard_rate_table.tex}


<!-- ======================================================= -->
<!-- *************** Commercial Data *********************** --> 
<!-- ======================================================= -->

\include{tex_tables/Com_Length_Samples_by_State_CALCOM.tex}

\include{tex_tables/Com_Age_Samples_by_State_CALCOM.tex}

<!-- ======================================================= -->
<!-- ***************   Survey  Data  *********************** --> 
<!-- ======================================================= -->

\include{tex_tables/index_table.tex}

\include{tex_tables/nwfsc_wgbts_strata.tex}

\include{tex_tables/nwfsc_wcgbts_length_samps.tex}

\include{tex_tables/nwfsc_wcgbts_age_samps.tex}

<!-- ======================================================= -->
<!-- *************** Triennial  Data *********************** --> 
<!-- ======================================================= -->


\include{tex_tables/triennial_early_strata.tex}

\include{tex_tables/triennial_late_strata.tex}

\include{tex_tables/triennial_early_length_samps.tex}

\include{tex_tables/triennial_late_length_samps.tex}

<!-- ======================================================= -->
<!-- *************** AFSC Slope Data  ********************** --> 
<!-- ======================================================= -->


\include{tex_tables/afsc_slope_strata.tex}

\include{tex_tables/afsc_slope_length_samps.tex}

<!-- ======================================================= -->
<!-- *************** NWFSC Slope  Data ********************* --> 
<!-- ======================================================= -->


\include{tex_tables/nwfsc_slope_strata.tex}

\include{tex_tables/nwfsc_slope_length_samps.tex}

\include{tex_tables/nwfsc_slope_age_samps.tex}

<!-- ======================================================= -->
<!-- ***********   Model Structure      ******************** --> 
<!-- ======================================================= -->

\include{tex_tables/model_info.tex}

<!-- ======================================================= -->
<!-- ***********   Model Parameters     ******************** --> 
<!-- ======================================================= -->


```{r, results = 'asis'}
mod_params = model$parameters[-c(grep('Impl',model$parameters$Label),
							     grep('Fore',model$parameters$Label)),
                                (names(model$parameters) %in%
                                c("Num","Label","Value","Phase","Min",
                                  "Max","Status","Parm_StDev",
                                  "Pr_type","Prior","Pr_SD"))] 
mod_params[,'Value'] = round(as.numeric(mod_params[,'Value']),3)                                 
# Combine bounds into one column
mod_params$Min = paste('(', mod_params$Min, ', ', mod_params$Max, ')', sep='')
# Combine prior info to one column
mod_params$PR_type = ifelse(mod_params$Pr_type == 'No_prior' , 'None', paste(mod_params$Pr_type,' (', mod_params$Prior,  ', ', mod_params$Pr_SD, ')', sep = ''))
# Set long value to scientific notation
mod_params[mod_params$Label == "Wtlen_1_Fem",3] = format(mod_params[mod_params$Label == "Wtlen_1_Fem",3], scientific = TRUE)
mod_params[mod_params$Label == "Wtlen_1_Mal",3] = format(as.numeric(mod_params[mod_params$Label == "Wtlen_1_Mal",3]), scientific = TRUE)
mod_params[mod_params$Label == "Eggs_scalar_Fem",3] = format(as.numeric(mod_params[mod_params$Label == "Eggs_scalar_Fem",3]), scientific = TRUE)
mod_params[mod_params$Label == "L_at_Amax_Mal_GP_1",3] = round(as.numeric(mod_params[mod_params$Label == "L_at_Amax_Mal_GP_1",3]), 4)
mod_params[mod_params$Label == "VonBert_K_Mal_GP_1",3] = round(as.numeric(mod_params[mod_params$Label == "VonBert_K_Mal_GP_1",3]), 3)
mod_params[mod_params$Label == "CV_old_Mal_GP_1",3] = round(as.numeric(mod_params[mod_params$Label == "CV_old_Mal_GP_1",3]), 3)
# Remove the max, prior and prior sd columns
drops = c('Max', 'Prior', 'Pr_type', 'Pr_SD', 'Num')
mod_params = mod_params[, !(names(mod_params) %in% drops)]
rownames(mod_params) = c()
mod_params[,"Label"] = gsub("\\_", " ", mod_params[,"Label"])
mod_params[,"PR_type"] = gsub("\\_", " ", mod_params[,"PR_type"])
# Add column names
col_names = c('Parameter',
                         'Value',
                         'Phase',
                         'Bounds',
                         'Status',
                         'SD',
                         'Prior (Exp.Val, SD)')
table_format(x = mod_params,
             caption = "List of parameters used in the base model, including estimated values and standard deviations (SD), bounds (minimum and maximum), estimation phase (negative values not estimated), status (indicates if parameters are near bounds), and prior type information (mean and SD).",
             label = "params",
             align = 'l',
             col_names = col_names,
             longtable = TRUE,
             font_size = 9,
             landscape = TRUE,
             custom_width = TRUE,
             col_to_adjust = c(1,7), 
             width = c("7cm", "4cm"))                         
```

<!-- ======================================================= -->
<!-- ***********    Like Contributions  ******************** --> 
<!-- ======================================================= -->


\include{tex_tables/likelihoods.tex}

<!-- ======================================================= -->
<!-- ********  Reference Points & Management *************** --> 
<!-- ======================================================= -->

\include{tex_tables/e_ReferencePoints_ES.tex}

<!-- ======================================================= -->
<!-- ***********       Time Series      ******************** --> 
<!-- ======================================================= -->

\include{tex_tables/TimeSeries.tex}

\newpage


<!-- ======================================================= -->
<!-- ****************     Sensitivities      *************** --> 
<!-- ======================================================= -->

```{r, results = 'asis'}
tab = read.csv(file.path(mod_loc, 'tables', 'data_weights.csv'))

col_names = c('Data',
 			        'Francis',
              'McAllister Ianelli',
              'Dirichlet Multinomial')
table_format(x = tab,
              caption = "Data weights applied by each alternative data weighting method. Weights for the Dirichlet
              multinomial are undetermined due to inconsistent results relative to input sample sizes and parameters
              hitting bounds.",
              label = "dw",
              align = 'l',
              digits = 3, 
              col_names = col_names)
```

\newpage

\include{tex_tables/sensitivities_crw.tex}

\include{tex_tables/sensitivities2_crw.tex}

<!-- ======================================================= -->
<!-- ********  Reference Points & Management *************** --> 
<!-- ======================================================= -->

```{r, results = 'asis'}
tab = read.csv(file.path(mod_loc, 'tables', 'g_Projections_ES.csv'))
spex_removal = c(model$derived_quants[model$derived_quants$Label == "ForeCatch_2021", "Value"], 
                 model$derived_quants[model$derived_quants$Label == "ForeCatch_2022", "Value"])

out = cbind(tab$Year,
            c(93547, 87540, rep("-",10)),
            c(84192, 78436, rep("-",10)),
            c(50000, 50000, rep("-", 10)),
            c(round(spex_removal,0), rep("-", 10)),
            c(rep("-",2), round(tab[3:12,2], 0)),
            c(rep("-",2), round(tab[3:12,3], 0)),
            c(rep("-",2), round(tab[3:12,3]/tab[3:12,2], 3)),
            round(tab[ ,5:ncol(tab)], 2))

col_names = c('Year',
              'Adopted OFL (mt)',
              'Adopted ABC (mt)',
              "Adopted ACL (mt)",
              "Assumed Removal (mt)", 
              "OFL (mt)", 
              "ABC (mt)", 
              "Buffer",
              "Spawning Biomass (mt)",
              "Fraction Unfished")

table_format(x = out,
             caption = "Projections of potential OFLs (mt), ABCs (mt), the buffer (ABC = buffer x OFL), estimated spawning biomass, and fraction unfished. The adopted OFL, ABC, and ACL for 2021 and 2022 reflect adopted management limits and the assumed removal is the removal assumptions applied for 2021 and 2022. The full ABC was assumed to be removed for 2023 - 2032",
             label = "project",
             align = 'l',
             landscape = TRUE,
             custom_width = TRUE,
             col_to_adjust = 1:10, 
             width = rep("2cm", 10),
             col_names = col_names)
```


